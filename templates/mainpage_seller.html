{% extends "layout.html" %}
{% block title %}
Seller Main Page
{% endblock %}

{% block main %}

<div class="container mx-auto mt-10 px-4 flex flex-col gap-6">

<div class="flex flex-col gap-2">
    <h2 class="text-2xl font-bold">My Tasks</h2>
    <p class="text-gray-700">Welcome, {{ profile.username }}!</p>
</div>

<div>
    <button id="toggleFormBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
        + Add New Service
    </button>
</div>

<div id="serviceForm" class="bg-white p-6 rounded shadow-md hidden">
    <form method="POST" action="/add_service" class="flex flex-col gap-4">
        <input type="text" name="title" placeholder="Title" class="w-full border border-gray-300 p-2 rounded" required>
        <textarea name="description" placeholder="Description" class="w-full border border-gray-300 p-2 rounded" required></textarea>
        <input type="number" name="price" step="0.01" placeholder="Price (RM)" class="w-full border border-gray-300 p-2 rounded" required>
        
        <label for="tag">Category</label>
            <select name="tag" id="tag">
                {% for tag in tags %}
                <option value="{{ tag }}">{{ tag }}</option>
                {% endfor %}
            </select>
            
        <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
            Add Service
        </button>
    </form>
</div>

<div class="mt-4">
    <a href="{{ url_for('upload_resume') }}">
        <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
            Improve My Profile
        </button>
    </a>
    {% if profile.resume %}
        <span class="ml-2 text-green-600 text-sm font-medium">Résumé uploaded!</span>
    {% else %}
        <span class="ml-2 text-gray-500 text-sm">No résumé uploaded</span>
    {% endif %}
</div>

{% if services %}
<div class="flex flex-wrap gap-6 justify-start">
    {% for service in services %}
    <div class="serviceCard bg-white shadow-md rounded-lg p-4 flex flex-col justify-between hover:shadow-xl transition-shadow w-full sm:w-[48%] md:w-[30%] relative">
        <div class="serviceInfo">
            <h3 class="font-semibold text-lg text-gray-800 mb-2">{{ service.title }}</h3>
            <p class="text-gray-600 mb-4">{{ service.description }}</p>
        </div>

        <div class="flex items-center justify-between mt-auto">
            <span class="font-medium text-gray-900">
                {% if service.price %}
                    RM {{ service.price }}
                {% else %}
                    -
                {% endif %}
            </span>

            <button class="toggleActions bg-gray-200 text-gray-800 px-2 py-1 rounded hover:bg-gray-300 text-sm transition">
                ⋮
            </button>
        </div>

        <div class="actionButtons hidden flex gap-2 mt-3">
            <button type="button" class="editBtn bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 transition text-sm">
                Edit
            </button>

            <form method="POST" action="/delete_service" onsubmit="return confirm('Are you sure you want to delete this service?');">
                <input type="hidden" name="service_id" value="{{ service.id }}">
                <button type="submit" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700 transition text-sm">
                    Delete
                </button>
            </form>
        </div>

        <div class="editForm hidden mt-3">
            <form method="POST" action="/edit_service" class="flex flex-col gap-2">
                <input type="hidden" name="service_id" value="{{ service.id }}">
                <input type="text" name="title" value="{{ service.title }}" class="border border-gray-300 p-2 rounded" required>
                <textarea name="description" class="border border-gray-300 p-2 rounded" required>{{ service.description }}</textarea>
                <input type="number" step="0.01" name="price" value="{{ service.price }}" class="border border-gray-300 p-2 rounded" required>

                <div class="flex gap-2 mt-2">
                    <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition text-sm">
                        Save
                    </button>
                    <button type="button" class="cancelEdit bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-500 transition text-sm">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p class="text-gray-500 mt-4">You haven't created any services yet.</p>
{% endif %}
</div>

<script>
    const toggleBtn = document.getElementById('toggleFormBtn');
    const form = document.getElementById('serviceForm');
    toggleBtn.addEventListener('click', () => form.classList.toggle('hidden'));

    document.querySelectorAll('.toggleActions').forEach(button => {
        button.addEventListener('click', () => {
            const card = button.closest('.serviceCard');
            const actions = card.querySelector('.actionButtons');
            actions.classList.toggle('hidden');
        });
    });

    document.querySelectorAll('.editBtn').forEach(button => {
        button.addEventListener('click', () => {
            const card = button.closest('.serviceCard');
            const info = card.querySelector('.serviceInfo');
            const editForm = card.querySelector('.editForm');
            const actions = card.querySelector('.actionButtons');

            info.classList.add('hidden');
            actions.classList.add('hidden');
            editForm.classList.remove('hidden');
        });
    });

    document.querySelectorAll('.cancelEdit').forEach(button => {
        button.addEventListener('click', () => {
            const card = button.closest('.serviceCard');
            const info = card.querySelector('.serviceInfo');
            const editForm = card.querySelector('.editForm');

            editForm.classList.add('hidden');
            info.classList.remove('hidden');
        });
    });
</script>

{% endblock %}